<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión - WE SEND MONEY</title>
    <link rel="icon" href="logo.svg" type="image/svg+xml">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="logo.svg" alt="Logo" width="70" height="70">
              <h1 style="margin-left: -20px; font-size: 15px; transform: translateY(4px);">
        <span style="color: white;">E</span><span style="color: white;">SEND</span><span style="color: white;">MONEY</span></h1>
        </div>
    </header>

    <div class="container">
        <h1>Inicio de Sesión</h1>
        <div class="input-group">
            <label for="loginEmail">Correo electrónico</label>
            <input type="email" id="loginEmail" placeholder="Correo electrónico" required>
        </div>
        <div class="input-group">
            <label for="loginPassword">Contraseña</label>
            <input type="password" id="loginPassword" placeholder="Contraseña" required>
        </div>
        <div class="input-group">
            <div id="message"></div>
            <button class="login-button" onclick="login()">Iniciar Sesión</button>
        </div>
        <hr>
        <span class="register-link" onclick="window.location.href='register.html'">¿No tienes cuenta? Regístrate</span>
    </div>

    <script src="scripts.js"></script>
    <!-- Agrega esto antes del cierre de </body> -->
<script>
document.getElementById("loginForm").addEventListener("submit", async function(e) {
    e.preventDefault();
    
    // Tu lógica de login existente...
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;

    try {
        // ... (tu código de login existente)

        // Si el login es exitoso, inicializar notificaciones
        if (data.success) {
            await initializePushNotifications();
            // Resto de tu lógica de redirección...
        }
    } catch (error) {
        // Manejo de errores
    }
});

async function initializePushNotifications() {
    if ('serviceWorker' in navigator && 'PushManager' in window) {
        try {
            const token = await requestNotificationPermission();
            if (token) {
                await saveFCMToken(token);
                
                // Configurar el listener de mensajes
                messaging.onMessage((payload) => {
                    console.log('Mensaje recibido:', payload);
                    if (payload.notification) {
                        showCustomNotification(payload.notification.title, payload.notification.body);
                    }
                });
            }
        } catch (error) {
            console.error('Error inicializando notificaciones:', error);
        }
    }
}
</script>
</body>
</html>
